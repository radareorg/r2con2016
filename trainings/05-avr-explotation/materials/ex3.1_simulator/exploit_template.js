var spawn    = require('child_process').spawn,
    simulavr = spawn('simulavr', ['-d', 'atmega128', '-f', process.argv[2], '-F', '16000000', '-x', '-,E1,9600', '-y', '-,E0,9600']);
    exploit  = [0x41, 0x42, 0x43, 13, 10];

simulavr.stdin.setEncoding('ascii');
simulavr.stdout.setEncoding('ascii');
simulavr.stderr.setEncoding('ascii');

simulavr.stdout.on('data', function (data) {
  process.stdout.write(data); 
  if(data == '\n')
	simulavr.stdin.write(new Buffer(exploit));
});

simulavr.stderr.on('data', function (data) {
  process.stdout.write(data);
});

simulavr.on('close', function (code) {
  console.log('terminated: ' + code);
});
